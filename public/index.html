<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Model Proxy Tester</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 2rem auto; }
    label { display:block; margin-top: .75rem }
    textarea { width:100%; height:120px }
    pre { background:#f6f8fa; padding:1rem; overflow:auto }
    .row { display:flex; gap:1rem }
    .col { flex:1 }
    
    .tabs { display:flex; border-bottom: 1px solid #ddd; margin-bottom: 1rem }
    .tab { padding: 0.5rem 1rem; cursor: pointer; border: none; background: none }
    .tab.active { background: #007acc; color: white }
    .tab-content { display: none }
    .tab-content.active { display: block }
    
    #simpleChat { max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem }
    .message { margin-bottom: 0.5rem; padding: 0.25rem }
    .user { color: #0066cc; font-weight: bold }
    .assistant { color: #006600 }
    .error { color: #cc0000; background: #ffe6e6; padding: 0.5rem; border-radius: 4px }
    .loading { color: #666; font-style: italic }
    
    .model-status { font-size: 0.8em; margin-left: 0.5rem }
    .working { color: #006600 }
    .error-status { color: #cc0000 }
    
    .clear-btn { background: #ff6b6b; color: white; border: none; padding: 0.25rem 0.5rem; margin-left: 0.5rem; border-radius: 3px; cursor: pointer }
    .test-btn { background: #4ecdc4; color: white; border: none; padding: 0.25rem 0.5rem; margin-left: 0.5rem; border-radius: 3px; cursor: pointer }
  </style>
</head>
<body>
  <h1>Model Proxy Tester</h1>
  <p>Send a chat or completion request to the local proxy.</p>

  <div class="tabs">
    <button class="tab active" onclick="showTab('advanced')">Advanced</button>
    <button class="tab" onclick="showTab('simple')">Simple Chat</button>
    <button class="tab" onclick="showTab('tools')">üõ†Ô∏è Code Generator</button>
  </div>

  <div id="advanced-tab" class="tab-content active">

  <label>Model ID
                <select id="model" required>
              <option value="openai/gpt-4o-mini">openai/gpt-4o-mini</option>
              <option value="openai/gpt-4o">openai/gpt-4o</option>
              <option value="gpt-4o-mini">gpt-4o-mini</option>
              <option value="gpt-4o">gpt-4o</option>
              <option value="microsoft/Phi-3.5-mini-instruct">microsoft/Phi-3.5-mini-instruct</option>
              <option value="microsoft/Phi-3-mini-4k-instruct">microsoft/Phi-3-mini-4k-instruct</option>
              <option value="Phi-3.5-mini-instruct">Phi-3.5-mini-instruct</option>
              <option value="Phi-3-mini-4k-instruct">Phi-3-mini-4k-instruct</option>
              <option value="Phi-3-medium-4k-instruct">Phi-3-medium-4k-instruct</option>
              <option value="microsoft/Phi-3.5-MoE-instruct">microsoft/Phi-3.5-MoE-instruct</option>
              <option value="microsoft/Phi-3.5-vision-instruct">microsoft/Phi-3.5-vision-instruct</option>
              <option value="microsoft/Phi-3-small-8k-instruct">microsoft/Phi-3-small-8k-instruct</option>
              <option value="microsoft/Phi-3-small-128k-instruct">microsoft/Phi-3-small-128k-instruct</option>
              <option value="microsoft/Phi-3-medium-4k-instruct">microsoft/Phi-3-medium-4k-instruct</option>
              <option value="Phi-3-small-8k-instruct">Phi-3-small-8k-instruct</option>
              <option value="Phi-3-small-128k-instruct">Phi-3-small-128k-instruct</option>
              <option value="AI21-Jamba-1.5-Large">AI21-Jamba-1.5-Large</option>
              <option value="AI21-Jamba-1.5-Mini">AI21-Jamba-1.5-Mini</option>
              <option value="Cohere-command-r-08-2024">Cohere-command-r-08-2024</option>
              <option value="Cohere-command-r-plus-08-2024">Cohere-command-r-plus-08-2024</option>
              <option value="Meta-Llama-3.1-8B-Instruct">Meta-Llama-3.1-8B-Instruct</option>
              <option value="Meta-Llama-3.1-405B-Instruct">Meta-Llama-3.1-405B-Instruct</option>
              <option value="Mistral-Nemo">Mistral-Nemo</option>
            </select>
  </label>

  <label>Type
    <select id="type"><option value="chat">chat</option><option value="completion">completion</option></select>
  </label>

  <label>Messages (JSON array) ‚Äî for chat, e.g. [{"role":"user","content":"Hello"}]
    <textarea id="input">[{"role":"user","content":"Hello"}]</textarea>
  </label>

  <div class="row">
    <div class="col"><label>Options (JSON) ‚Äî optional
      <textarea id="options">{"temperature":0}</textarea>
    </label></div>
    <div class="col">
      <label>&nbsp;<br /><button id="send">Send</button> <button id="textOnly">Text only</button></label>
    </div>
  </div>

  <h3>Response</h3>
  <pre id="result">(no response yet)</pre>
  <h3>History</h3>
  <pre id="history">(no history)</pre>
  </div>

  <div id="simple-tab" class="tab-content">
    <label>Model
                  <select id="simpleModel" required>
              <option value="openai/gpt-4o-mini">openai/gpt-4o-mini (—à–≤–∏–¥–∫–∞)</option>
              <option value="openai/gpt-4o">openai/gpt-4o (–ø–æ—Ç—É–∂–Ω–∞)</option>
              <option value="gpt-4o-mini">gpt-4o-mini (–∫–æ—Ä–æ—Ç–∫–∞ –Ω–∞–∑–≤–∞)</option>
              <option value="gpt-4o">gpt-4o (–∫–æ—Ä–æ—Ç–∫–∞ –Ω–∞–∑–≤–∞)</option>
              <option value="microsoft/Phi-3.5-mini-instruct">microsoft/Phi-3.5-mini-instruct (–º—ñ–Ω—ñ)</option>
              <option value="microsoft/Phi-3-mini-4k-instruct">microsoft/Phi-3-mini-4k-instruct (–º—ñ–Ω—ñ 4K)</option>
              <option value="Phi-3.5-mini-instruct">Phi-3.5-mini-instruct (–∫–æ—Ä–æ—Ç–∫–∏–π –º—ñ–Ω—ñ)</option>
              <option value="Phi-3-mini-4k-instruct">Phi-3-mini-4k-instruct (–∫–æ—Ä–æ—Ç–∫–∏–π –º—ñ–Ω—ñ 4K)</option>
              <option value="Phi-3-medium-4k-instruct">Phi-3-medium-4k-instruct (—Å–µ—Ä–µ–¥–Ω—ñ–π)</option>
              <option value="microsoft/Phi-3.5-MoE-instruct">microsoft/Phi-3.5-MoE-instruct (–µ–∫—Å–ø–µ—Ä—Ç)</option>
              <option value="microsoft/Phi-3.5-vision-instruct">microsoft/Phi-3.5-vision-instruct (–∑—ñ—Ä)</option>
              <option value="microsoft/Phi-3-small-8k-instruct">microsoft/Phi-3-small-8k-instruct (8K –∫–æ–Ω—Ç–µ–∫—Å—Ç)</option>
              <option value="microsoft/Phi-3-small-128k-instruct">microsoft/Phi-3-small-128k-instruct (128K –∫–æ–Ω—Ç–µ–∫—Å—Ç)</option>
              <option value="microsoft/Phi-3-medium-4k-instruct">microsoft/Phi-3-medium-4k-instruct (—Å–µ—Ä–µ–¥–Ω—ñ–π 4K)</option>
              <option value="Phi-3-small-8k-instruct">Phi-3-small-8k-instruct (–º–∞–ª–∏–π 8K)</option>
              <option value="Phi-3-small-128k-instruct">Phi-3-small-128k-instruct (–º–∞–ª–∏–π 128K)</option>
              <option value="AI21-Jamba-1.5-Large">AI21-Jamba-1.5-Large (–≤–µ–ª–∏–∫–∏–π)</option>
              <option value="AI21-Jamba-1.5-Mini">AI21-Jamba-1.5-Mini (–∫–æ–º–ø–∞–∫—Ç–Ω–∏–π)</option>
              <option value="Cohere-command-r-08-2024">Cohere-command-r-08-2024 (–∫–æ–º–∞–Ω–¥–Ω–∏–π)</option>
              <option value="Cohere-command-r-plus-08-2024">Cohere-command-r-plus-08-2024 (–∫–æ–º–∞–Ω–¥–Ω–∏–π+)</option>
              <option value="Meta-Llama-3.1-8B-Instruct">Meta-Llama-3.1-8B-Instruct (8B)</option>
              <option value="Meta-Llama-3.1-405B-Instruct">Meta-Llama-3.1-405B-Instruct (405B –Ω–∞–π–±—ñ–ª—å—à–∞!)</option>
              <option value="Mistral-Nemo">Mistral-Nemo (–Ω–µ–º–æ)</option>
            </select>
      <button class="clear-btn" id="clearChat">Clear</button>
      <button class="test-btn" id="testModel">Test Model</button>
    </label>
    
    <div id="simpleChat"></div>
    
    <div class="row">
      <div class="col">
        <input id="simpleInput" placeholder="Type your message..." style="width:100%; padding:0.5rem" />
      </div>
      <div style="flex:0">
        <button id="simpleSend" style="padding:0.5rem 1rem">Send</button>
      </div>
    </div>
  </div>

  <!-- Tools Tab -->
  <div id="tools-tab" class="tab-content">
    <h2>üõ†Ô∏è Code Generator</h2>
    <p>Generate ready-to-use code examples for different programming languages and scenarios.</p>
    
    <div class="row">
      <div class="col">
        <label>Programming Language
          <select id="codeLanguage" required>
            <option value="js">JavaScript (Node.js)</option>
            <option value="python">Python</option>
            <option value="bash">Shell/Bash</option>
          </select>
        </label>
        
        <label>Code Type
          <select id="codeType" required>
            <option value="basic">Basic Chat Example</option>
            <option value="interactive">Interactive Chat</option>
            <option value="benchmark">Performance Benchmark</option>
          </select>
        </label>
        
        <label>Model to Use
          <select id="codeModel" required>
            <option value="gpt-4o-mini">gpt-4o-mini (fastest)</option>
            <option value="gpt-4o">gpt-4o (powerful)</option>
            <option value="Phi-3.5-mini-instruct">Phi-3.5-mini-instruct</option>
            <option value="AI21-Jamba-1.5-Large">AI21-Jamba-1.5-Large</option>
            <option value="Meta-Llama-3.1-70B-Instruct">Meta-Llama-3.1-70B-Instruct</option>
            <option value="Cohere-command-r-plus">Cohere-command-r-plus</option>
          </select>
        </label>
        
        <label>Custom Prompt (optional)
          <input id="codePrompt" placeholder="e.g., Write a joke about programming" style="width:100%; padding:0.5rem" />
        </label>
        
        <div style="margin-top: 1rem;">
          <button id="generateCode" style="background: #28a745; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.5rem;">
            üöÄ Generate Code
          </button>
          <button id="downloadCode" style="background: #17a2b8; color: white; border: none; padding: 0.75rem 1rem; border-radius: 4px; cursor: pointer;">
            üíæ Download
          </button>
        </div>
      </div>
    </div>
    
    <div style="margin-top: 2rem;">
      <h3>Generated Code:</h3>
      <pre id="codeOutput" style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 1rem; min-height: 200px; white-space: pre-wrap; font-family: 'Courier New', monospace;">
Click "Generate Code" to create a ready-to-use example...
      </pre>
    </div>
    
    <div style="margin-top: 1rem; background: #e7f3ff; padding: 1rem; border-radius: 4px;">
      <h4>üí° Quick Tips:</h4>
      <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
        <li><strong>JavaScript:</strong> Ready for Node.js, includes error handling</li>
        <li><strong>Python:</strong> Includes timing and usage statistics</li>
        <li><strong>Shell:</strong> Uses curl with both simple and OpenAI APIs</li>
        <li><strong>Download:</strong> Get the code as a file to run locally</li>
      </ul>
      
      <p style="margin: 0.5rem 0;"><strong>Terminal Usage:</strong></p>
      <code style="background: #2d3748; color: #e2e8f0; padding: 0.25rem 0.5rem; border-radius: 3px;">
        node code-generator.mjs basic js gpt-4o-mini "Your prompt here"
      </code>
    </div>
  </div>

  <script>
    const send = document.getElementById('send');
    const result = document.getElementById('result');
    const textOnlyBtn = document.getElementById('textOnly');
    const historyPre = document.getElementById('history');

    function showTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(tabName + '-tab').classList.add('active');
    }

    // Simple chat functionality
    const simpleChat = document.getElementById('simpleChat');
    const simpleInput = document.getElementById('simpleInput');
    const simpleSend = document.getElementById('simpleSend');
    const simpleModel = document.getElementById('simpleModel');
    const clearChat = document.getElementById('clearChat');
    const testModel = document.getElementById('testModel');

    function addMessage(role, content) {
      const div = document.createElement('div');
      div.className = `message ${role}`;
      if (role === 'error') {
        div.innerHTML = `<span class="${role}">error:</span> ${content}`;
      } else if (role === 'loading') {
        div.innerHTML = `<span class="${role}">‚è≥ loading...</span>`;
      } else {
        div.innerHTML = `<span class="${role}">${role}:</span> ${content}`;
      }
      simpleChat.appendChild(div);
      simpleChat.scrollTop = simpleChat.scrollHeight;
      return div;
    }

    function clearChatHistory() {
      simpleChat.innerHTML = '';
    }

    async function testCurrentModel() {
      const model = simpleModel.value;
      const loadingMsg = addMessage('loading', `Testing ${model}...`);
      
      try {
        const response = await fetch('/v1/simple-chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ model, message: "Test" })
        });
        
        const data = await response.json();
        loadingMsg.remove();
        
        if (data.error) {
          addMessage('error', `${model} - ${data.error}`);
        } else {
          addMessage('assistant', `‚úÖ ${model} works! Response: "${data.response.substring(0, 50)}..."`);
        }
      } catch (err) {
        loadingMsg.remove();
        addMessage('error', `${model} - Connection error: ${err.message}`);
      }
    }

    async function sendSimpleMessage() {
      const message = simpleInput.value.trim();
      if (!message) return;
      
      const model = simpleModel.value;
      addMessage('user', message);
      simpleInput.value = '';
      
      try {
        const response = await fetch('/v1/simple-chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ model, message })
        });
        
        const data = await response.json();
        if (data.error) {
          addMessage('error', data.error);
        } else {
          addMessage('assistant', data.response);
        }
      } catch (err) {
        addMessage('error', 'Connection error: ' + err.message);
      }
    }

    simpleSend.addEventListener('click', sendSimpleMessage);
    simpleInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendSimpleMessage();
    });
    
    clearChat.addEventListener('click', clearChatHistory);
    testModel.addEventListener('click', testCurrentModel);

    async function appendHistory(entry){
      try{
        const r = await fetch('/v1/history', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(entry) });
        const json = await r.json();
        historyPre.textContent = JSON.stringify(json, null, 2);
      }catch(e){ console.warn('history save failed', e); }
    }

    send.addEventListener('click', async ()=>{
      const model = document.getElementById('model').value;
      const type = document.getElementById('type').value;
      let input;
      try{ input = JSON.parse(document.getElementById('input').value); }catch(e){ alert('Invalid JSON in Messages'); return }
      let options = {};
      try{ options = JSON.parse(document.getElementById('options').value); }catch(e){ alert('Invalid JSON in Options'); return }

      result.textContent = '...loading';
      try{
        const r = await fetch('/v1/proxy', {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ model, type, input, options })
        });
        const json = await r.json();
        result.textContent = JSON.stringify(json, null, 2);
        appendHistory({ ts: new Date().toISOString(), req: { model, type, input, options }, res: json });
      }catch(err){
        result.textContent = String(err);
      }
    });

    textOnlyBtn.addEventListener('click', async ()=>{
      const model = document.getElementById('model').value;
      const type = document.getElementById('type').value;
      let input;
      try{ input = JSON.parse(document.getElementById('input').value); }catch(e){ alert('Invalid JSON in Messages'); return }
      let options = {};
      try{ options = JSON.parse(document.getElementById('options').value); }catch(e){ alert('Invalid JSON in Options'); return }
      result.textContent = '...loading';
      try{
        const r = await fetch('/v1/proxy', {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ model, type, input, options })
        });
        const json = await r.json();
        // try to extract human text
        let text = JSON.stringify(json);
        try{
          if(json.choices && json.choices[0]){
            const c = json.choices[0];
            if(c.message && c.message.content) text = c.message.content;
            else if(c.text) text = c.text;
            else if(json.output && Array.isArray(json.output) && json.output[0].content && json.output[0].content[0]){
              text = json.output[0].content[0].text || JSON.stringify(json.output);
            }
          } else if(json.output && json.output[0] && json.output[0].content){
            // new responses format
            const content = json.output[0].content.find(x=>x.type==='output_text' || x.type==='message');
            if(content) text = content.text || JSON.stringify(content);
          }
        }catch(e){ }
        result.textContent = text;
        appendHistory({ ts: new Date().toISOString(), req: { model, type, input, options }, res: { text } });
      }catch(err){ result.textContent = String(err); }
    });

    // Code Generator Tab
    document.getElementById('generateCode').addEventListener('click', async () => {
      const language = document.getElementById('codeLanguage').value;
      const type = document.getElementById('codeType').value;
      const model = document.getElementById('codeModel').value;
      const prompt = document.getElementById('codePrompt').value || 'Hello, world!';
      
      const output = document.getElementById('codeOutput');
      output.textContent = 'Generating...';
      
      try {
        const response = await fetch('/api/generate-code', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ language, type, model, prompt })
        });
        
        const result = await response.json();
        if (result.error) {
          output.textContent = result.error;
        } else {
          output.textContent = result.code;
        }
      } catch (error) {
        output.textContent = 'Error: ' + error.message;
      }
    });

    document.getElementById('downloadCode').addEventListener('click', () => {
      const code = document.getElementById('codeOutput').textContent;
      const language = document.getElementById('codeLanguage').value;
      const type = document.getElementById('codeType').value;
      
      const extensions = { js: 'mjs', python: 'py', bash: 'sh' };
      const filename = `generated-${type}.${extensions[language] || 'txt'}`;
      
      const blob = new Blob([code], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
